Модули
================================================================================

Система модулей реализована в модуле `require('module')`.

Модули ядра
--------------------------------------------------------------------------------

Модули ядра находятся в папке `lib/` исходников node.

В первую очередь загружаются базовые модули, а потом уже пользовательские.

Файлы модулей
--------------------------------------------------------------------------------

Если файл с точным именем модуля не будет найден, node попытается загрузить запрошенное имя файла с добавлением расширения `.js`, `.json` или `.node`.

Файлы `.node` интерпретируются как компилированные дополнительные модули и загружаются с помощью `dlopen`.

`/...` - абсолютный путь.

`./...` - путь, относительный файла, вызывающего require().

Если ведущий / не указан, модуль будет загружен из папки `node_modules` и выше.

Если путь все равно не найден, будет возбуждено исключение со значением code `MODULE_NOT_FOUND`

Папки как директории
--------------------------------------------------------------------------------

Файл `package.json`:

    {
        "name" : "some-library",
        "main" : "./lib/some-library.js"
    }

Если файла package.json нет, пытается загрузить `index.js` или `index.node`.

Кэширование
--------------------------------------------------------------------------------

Модули кэшируются после первой загрузки. require('foo') будет возвращать тот же самый объект для одного и того же файла.

Объект module
--------------------------------------------------------------------------------

`module.exports` то же самое что `exports`.

### module.exports

Модуль как объект:

    module.exports = MyClass;

Данное присвоение должно быть мгновенным, без коллбеков.

### module.require(id)

Позволяет вызвать метод require(), как если бы он был вызван из оригинального модуля.

### module.id

Идентификатор модуля. Обычно представляет имя файла.

### module.filename

Полное имя файла.

### module.loaded

Логическое значение. Загружается ли еще модуль или уже загружен.

### module.parent

Модуль, который вызвал required() для этого модуля.

### module.children

Массив модулей, загруженных данным модулем.

### require.resolve()

Возвращает путь к файлу по идентификатору модуля.

Загрузка из глобальных папок
--------------------------------------------------------------------------------

Переменная среды `NODE_PATH` содержит разделенные запятыми абсолютные пути поиска модулей.

В дополнение модули будут искаться в следующих папках:

1. $HOME/.node_modules
2. $HOME/.node_libraries
3. $PREFIX/lib/node

Доступ к главному модулю
--------------------------------------------------------------------------------

Когда файл выполняется напрямую с помощью node, `require.main` принимает значение `module`.

Определение, выполняется ли главный модуль:

    require.main === module

Получить значение корневого файла приложения можно следующим образом:

    require.main.filename